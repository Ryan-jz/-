# å›½é™…åŒ–åŠŸèƒ½è°ƒè¯•æŒ‡å—

## é—®é¢˜æè¿°
å‰ç«¯é€šè¿‡ `Accept-Language` è¯·æ±‚å¤´å‘é€è¯­è¨€å‚æ•°ï¼ˆå¦‚ `de-DE`ï¼‰ï¼Œä½†åç«¯APIä»ç„¶è¿”å›ä¸­æ–‡å†…å®¹ã€‚

## å·²å®Œæˆçš„å·¥ä½œ

### 1. ä¸­é—´ä»¶å®ç° âœ…
- æ–‡ä»¶ï¼š`backend/internal/middleware/i18n.go`
- åŠŸèƒ½ï¼šä» `Accept-Language` è¯·æ±‚å¤´æå–è¯­è¨€ä»£ç 
- æ”¯æŒçš„è¯­è¨€ï¼šzh-CNï¼ˆä¸­æ–‡ï¼‰ã€en-USï¼ˆè‹±æ–‡ï¼‰ã€de-DEï¼ˆå¾·æ–‡ï¼‰
- ä¼˜å…ˆçº§ï¼šURLå‚æ•° > Accept-Language Header > é»˜è®¤è¯­è¨€

### 2. è·¯ç”±é…ç½® âœ…
- æ–‡ä»¶ï¼š`backend/internal/router/router.go`
- å·²å°† i18n ä¸­é—´ä»¶æ·»åŠ åˆ° `/api/v1` è·¯ç”±ç»„

### 3. æ§åˆ¶å™¨æ›´æ–° âœ…
- Banneræ§åˆ¶å™¨ï¼š`backend/internal/controller/api/banner.go`
- Productæ§åˆ¶å™¨ï¼š`backend/internal/controller/api/product.go`
- éƒ½å·²æ›´æ–°ä¸ºä½¿ç”¨ `middleware.GetLocale(r.Context())` è·å–è¯­è¨€

### 4. æœåŠ¡å±‚å®ç° âœ…
- BanneræœåŠ¡ï¼š`backend/internal/service/banner.go`
- ProductæœåŠ¡ï¼š`backend/internal/service/product.go`
- éƒ½å·²å®ç° LEFT JOIN æŸ¥è¯¢ i18n è¡¨ï¼Œæ ¹æ® locale å‚æ•°è¿”å›å¯¹åº”è¯­è¨€å†…å®¹

### 5. å‰ç«¯é…ç½® âœ…
- **frontend-web**ï¼šå·²é…ç½® Accept-Language è¯·æ±‚å¤´ï¼ˆ`frontend-web/src/utils/request.js`ï¼‰
- **frontend-admin**ï¼šå·²æ·»åŠ é»˜è®¤ Accept-Language è¯·æ±‚å¤´ï¼ˆ`frontend-admin/src/utils/request.js`ï¼‰

### 6. è°ƒè¯•æ—¥å¿— âœ…
å·²åœ¨ä¸­é—´ä»¶å’Œæ§åˆ¶å™¨ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚

## ğŸ”´ å…³é”®æ­¥éª¤ï¼šé‡æ–°ç¼–è¯‘åç«¯

**å½“å‰é—®é¢˜çš„æ ¹æœ¬åŸå› ï¼šåç«¯ä»£ç å·²æ›´æ–°ï¼Œä½†å¯èƒ½æ²¡æœ‰é‡æ–°ç¼–è¯‘ï¼**

### ç¼–è¯‘æ­¥éª¤ï¼š

1. **åœæ­¢å½“å‰è¿è¡Œçš„åç«¯æœåŠ¡**

2. **é‡æ–°ç¼–è¯‘**
   ```bash
   cd backend
   .\build.bat
   ```

3. **å¯åŠ¨æ–°ç¼–è¯‘çš„æœåŠ¡**
   ```bash
   .\gf-admin.exe
   ```

4. **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**
   å¯åŠ¨åï¼Œå½“å‰ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œåº”è¯¥èƒ½çœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ—¥å¿—ï¼š
   ```
   I18n Middleware - Accept-Language Header: de-DE
   I18n Middleware - Extracted Locale: de-DE
   I18n Middleware - Final Locale: de-DE
   Banner.GetList - Using Locale: de-DE
   ```

## æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•å‰ç«¯ç½‘ç«™ï¼ˆfrontend-webï¼‰
1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰
2. è®¿é—®ç½‘ç«™é¦–é¡µ
3. ç‚¹å‡»å³ä¸Šè§’çš„è¯­è¨€åˆ‡æ¢å™¨ï¼Œé€‰æ‹©"Deutsch"
4. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼Œç¡®è®¤ Request Headers ä¸­æœ‰ï¼š
   ```
   Accept-Language: de-DE
   ```
5. æŸ¥çœ‹è¿”å›çš„æ•°æ®æ˜¯å¦ä¸ºå¾·è¯­å†…å®¹

### 2. æµ‹è¯•åå°ç®¡ç†ï¼ˆfrontend-adminï¼‰
1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
2. è®¿é—®è½®æ’­å›¾åˆ—è¡¨æˆ–äº§å“åˆ—è¡¨
3. æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼Œç¡®è®¤ Request Headers ä¸­æœ‰ï¼š
   ```
   Accept-Language: zh-CN
   ```
4. æ•°æ®åº”è¯¥è¿”å›ä¸­æ–‡å†…å®¹

### 3. æ‰‹åŠ¨æµ‹è¯•API
ä½¿ç”¨ Postman æˆ– curl æµ‹è¯•ï¼š

```bash
# æµ‹è¯•å¾·è¯­
curl -H "Accept-Language: de-DE" http://localhost:8000/api/v1/banner/list?position=home

# æµ‹è¯•è‹±è¯­
curl -H "Accept-Language: en-US" http://localhost:8000/api/v1/banner/list?position=home

# æµ‹è¯•ä¸­æ–‡
curl -H "Accept-Language: zh-CN" http://localhost:8000/api/v1/banner/list?position=home
```

## æ•°æ®åº“æ£€æŸ¥

ç¡®ä¿æ•°æ®åº“ä¸­æœ‰å¯¹åº”è¯­è¨€çš„æ•°æ®ï¼š

```sql
-- æ£€æŸ¥ banner_i18n è¡¨
SELECT * FROM banner_i18n WHERE locale = 'de-DE';

-- æ£€æŸ¥ product_i18n è¡¨
SELECT * FROM product_i18n WHERE locale = 'de-DE';

-- æ£€æŸ¥ product_category_i18n è¡¨
SELECT * FROM product_category_i18n WHERE locale = 'de-DE';

-- æ£€æŸ¥ recipe_i18n è¡¨
SELECT * FROM recipe_i18n WHERE locale = 'de-DE';
```

å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œéœ€è¦ï¼š
1. è¿è¡Œè¿ç§»è„šæœ¬ï¼š`backend/manifest/sql/i18n_migration.sql`
2. æˆ–è€…é€šè¿‡åå°ç®¡ç†ç³»ç»Ÿçš„ i18n ç¼–è¾‘å™¨æ·»åŠ ç¿»è¯‘

## å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šè¿”å›çš„è¿˜æ˜¯ä¸­æ–‡
**åŸå› **ï¼šåç«¯æ²¡æœ‰é‡æ–°ç¼–è¯‘
**è§£å†³**ï¼šæ‰§è¡Œ `cd backend && .\build.bat` é‡æ–°ç¼–è¯‘

### é—®é¢˜2ï¼šè¿”å›ç©ºæ•°æ®
**åŸå› **ï¼šæ•°æ®åº“ä¸­æ²¡æœ‰å¯¹åº”è¯­è¨€çš„ç¿»è¯‘æ•°æ®
**è§£å†³**ï¼š
1. æ£€æŸ¥æ•°æ®åº“ i18n è¡¨
2. é€šè¿‡åå°ç®¡ç†ç³»ç»Ÿæ·»åŠ ç¿»è¯‘

### é—®é¢˜3ï¼šä¸­é—´ä»¶æ²¡æœ‰ç”Ÿæ•ˆ
**åŸå› **ï¼šè·¯ç”±é…ç½®é—®é¢˜
**è§£å†³**ï¼šæ£€æŸ¥ `backend/internal/router/router.go`ï¼Œç¡®ä¿ä¸­é—´ä»¶å·²æ·»åŠ åˆ°è·¯ç”±ç»„

### é—®é¢˜4ï¼šæ—¥å¿—ä¸­çœ‹ä¸åˆ° Accept-Language
**åŸå› **ï¼šå‰ç«¯æ²¡æœ‰å‘é€è¯¥è¯·æ±‚å¤´
**è§£å†³**ï¼šæ£€æŸ¥å‰ç«¯ request.js é…ç½®

## ä¸‹ä¸€æ­¥å·¥ä½œ

1. âœ… é‡æ–°ç¼–è¯‘åç«¯ï¼ˆæœ€é‡è¦ï¼ï¼‰
2. â³ æ›´æ–° Recipe æ§åˆ¶å™¨ä½¿ç”¨ä¸­é—´ä»¶
3. â³ å®Œæˆ Recipe ç®¡ç†é¡µé¢çš„ i18n ç¼–è¾‘å™¨é›†æˆ
4. â³ æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ç«¯åˆ°ç«¯

## æ–‡ä»¶æ¸…å•

### åç«¯æ–‡ä»¶
- `backend/internal/middleware/i18n.go` - i18n ä¸­é—´ä»¶
- `backend/internal/router/router.go` - è·¯ç”±é…ç½®
- `backend/internal/controller/api/banner.go` - Banner æ§åˆ¶å™¨
- `backend/internal/controller/api/product.go` - Product æ§åˆ¶å™¨
- `backend/internal/service/banner.go` - Banner æœåŠ¡
- `backend/internal/service/product.go` - Product æœåŠ¡

### å‰ç«¯æ–‡ä»¶
- `frontend-web/src/utils/request.js` - ç½‘ç«™è¯·æ±‚é…ç½®
- `frontend-admin/src/utils/request.js` - ç®¡ç†åå°è¯·æ±‚é…ç½®
- `frontend-web/src/components/LanguageSwitcher.vue` - è¯­è¨€åˆ‡æ¢å™¨

### æ•°æ®åº“æ–‡ä»¶
- `backend/manifest/sql/i18n_migration.sql` - i18n è¡¨è¿ç§»è„šæœ¬
