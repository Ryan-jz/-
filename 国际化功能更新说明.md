# Banner 国际化功能更新说明

## 更新内容

已为 Banner 轮播图模块添加完整的国际化支持，支持中文、英文、德文三种语言。

## 新增文件

### 前端文件
1. `frontend-admin/src/components/I18nEditor/BannerI18nEditor.vue`
   - Banner 国际化编辑器组件
   - 支持三种语言的标签页切换
   - 可编辑标题、描述、按钮文字

### 后端文件
1. `backend/manifest/sql/banner_i18n_migration.sql`
   - 数据库迁移脚本
   - 创建 `banner_i18n` 表
   - 自动迁移现有数据

### 文档文件
1. `BANNER_I18N_GUIDE.md` - 完整使用指南
2. `backend/manifest/sql/BANNER_I18N_SETUP.md` - 数据库配置说明
3. `部署国际化功能.bat` - 快速部署脚本
4. `国际化功能更新说明.md` - 本文件

## 修改的文件

### 前端
1. `frontend-admin/src/views/banner/index.vue`
   - 集成国际化编辑器
   - 移除原有的单语言字段（title、description、buttonText）
   - 添加多语言内容编辑
   - 更新表单验证规则
   - 修改数据提交格式

2. `frontend-admin/src/api/banner.js`
   - 添加 `getBannerI18n()` 方法获取国际化数据

### 后端
1. `backend/internal/controller/api/banner.go`
   - 修改 `GetList()` 添加 locale 参数支持
   - 修改 `Create()` 接收国际化数据
   - 修改 `Update()` 接收国际化数据
   - 新增 `GetI18n()` 获取国际化数据

2. `backend/internal/service/banner.go`
   - 修改 `GetList()` 支持多语言查询
   - 修改 `Create()` 保存国际化数据（使用事务）
   - 修改 `Update()` 更新国际化数据（使用事务）
   - 新增 `GetI18n()` 查询国际化数据
   - 更新接口定义

3. `backend/internal/router/router.go`
   - 添加路由：`GET /api/v1/banner/:bannerId/i18n`

## 数据库变更

### 新增表：banner_i18n

```sql
CREATE TABLE `banner_i18n` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `banner_id` int(11) unsigned NOT NULL,
  `locale` varchar(10) NOT NULL,
  `title` varchar(200) NOT NULL,
  `description` text,
  `button_text` varchar(100) DEFAULT NULL,
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_banner_locale` (`banner_id`, `locale`),
  KEY `idx_locale` (`locale`),
  KEY `idx_banner_id` (`banner_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

### 数据迁移
- 现有 banner 数据会自动迁移到 banner_i18n 表
- 每个 banner 会创建 3 条记录（zh-CN、en-US、de-DE）
- 初始内容使用原有的中文数据

## 部署步骤

### 快速部署（推荐）

运行部署脚本：
```bash
部署国际化功能.bat
```

### 手动部署

1. **执行数据库迁移**
   ```bash
   mysql -u username -p database < backend/manifest/sql/banner_i18n_migration.sql
   ```

2. **编译后端**
   ```bash
   cd backend
   build.bat
   ```

3. **重启后端服务**
   - 停止当前运行的 gf-admin.exe
   - 重新运行 backend/gf-admin.exe

4. **刷新前端**
   - 刷新浏览器即可看到新功能

## 使用说明

### 后台管理

1. 登录后台管理系统
2. 进入"轮播图管理"
3. 点击"新增"或"编辑"
4. 在"多语言内容"部分切换标签页填写不同语言的内容
5. 保存

### API 调用

前端获取轮播图时传递 locale 参数：

```javascript
// 获取中文版本
getBannerList({ locale: 'zh-CN' })

// 获取英文版本
getBannerList({ locale: 'en-US' })

// 获取德文版本
getBannerList({ locale: 'de-DE' })
```

## 功能特点

1. ✅ 支持三种语言（中文、英文、德文）
2. ✅ 友好的标签页界面
3. ✅ 自动数据迁移
4. ✅ 事务保证数据一致性
5. ✅ 完整的 API 支持
6. ✅ 向后兼容（现有数据自动迁移）

## 注意事项

1. 必须先执行数据库迁移脚本
2. 创建轮播图时至少需要填写中文标题
3. 编辑时会自动加载所有语言版本
4. 前端需要根据用户语言选择传递 locale 参数

## 后续扩展

如需添加更多语言：

1. 在数据库中插入新语言数据
2. 在 `BannerI18nEditor.vue` 添加新标签页
3. 更新 `GetI18n()` 方法的 locales 数组

## 技术细节

### 前端架构
- 使用 Vue 3 Composition API
- Element Plus UI 组件
- 响应式数据绑定
- 组件化设计

### 后端架构
- GoFrame v2 框架
- 事务处理保证数据一致性
- RESTful API 设计
- 左连接查询优化性能

### 数据库设计
- 主表 + 国际化表分离
- 联合唯一索引防止重复
- 自动时间戳
- 外键关联

## 测试建议

1. 创建新轮播图，填写三种语言内容
2. 编辑现有轮播图，验证数据加载
3. 切换语言查看前端显示
4. 测试必填字段验证
5. 测试数据保存和更新

## 问题反馈

如遇到问题，请检查：
1. 数据库迁移是否成功
2. 后端是否重新编译
3. 浏览器控制台是否有错误
4. API 请求是否正常

详细故障排查请参考 `BANNER_I18N_GUIDE.md`
