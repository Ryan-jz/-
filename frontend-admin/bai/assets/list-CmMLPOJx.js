import{I as ee}from"./ImageUpload-kDQF2oOa.js";import{g as le,a as te,d as ae,u as oe,c as ne}from"./product-D73ubbXh.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as y,b as de}from"./element-plus-BcUKyH_i.js";import{l as P,r as c,j as se,B as v,C as l,D as a,ak as s,aq as ue,z as m,P as $,a4 as j,y as w,M as i,J as ie,E as pe,O as E}from"./vue-vendor-BRUv3CCy.js";import"./index-D6S6O2v3.js";const me={class:"product-list-container"},ge={key:1},ce={class:"pagination-container"},fe={__name:"list",setup(be){const r=P({categoryId:null,keyword:"",status:null,page:1,pageSize:10}),k=c(!1),V=c([]),h=c([]),O=c(0),f=c(!1),x=c("新增产品"),U=c(null),o=P({id:null,categoryId:null,name:"",nameEn:"",subtitle:"",description:"",image:"",price:0,stock:0,weight:"",ingredients:"",usage:"",sortOrder:0,status:1}),M={categoryId:[{required:!0,message:"请选择产品分类",trigger:"change"}],name:[{required:!0,message:"请输入产品名称",trigger:"blur"}]},N=async()=>{try{const n=await le({status:1});V.value=n.data.list||[]}catch(n){console.error("获取分类列表失败:",n)}},_=async()=>{k.value=!0;try{const n=await te(r);h.value=n.data.list||[],O.value=n.data.total||0}catch{y.error("获取产品列表失败")}finally{k.value=!1}},R=n=>{const e=V.value.find(b=>b.id===n);return e?e.name:"-"},B=n=>n?n.startsWith("http")?n:`/api${n}`:"",C=()=>{r.page=1,_()},T=()=>{r.categoryId=null,r.keyword="",r.status=null,r.page=1,_()},q=()=>{x.value="新增产品",Object.assign(o,{id:null,categoryId:null,name:"",nameEn:"",subtitle:"",description:"",image:"",price:0,stock:0,weight:"",ingredients:"",usage:"",sortOrder:0,status:1}),f.value=!0},F=n=>{x.value="编辑产品",Object.assign(o,n),f.value=!0},J=async()=>{U.value&&await U.value.validate(async n=>{if(n)try{o.id?(await oe(o),y.success("更新成功")):(await ne(o),y.success("创建成功")),f.value=!1,_()}catch(e){y.error(e.message||"操作失败")}})},W=n=>{de.confirm(`确定要删除产品"${n.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ae(n.id),y.success("删除成功"),_()}catch{y.error("删除失败")}})};return se(()=>{N(),_()}),(n,e)=>{const b=s("el-option"),I=s("el-select"),d=s("el-form-item"),p=s("el-input"),g=s("el-button"),S=s("el-form"),D=s("el-card"),u=s("el-table-column"),A=s("el-image"),G=s("el-tag"),H=s("el-table"),K=s("el-pagination"),z=s("el-input-number"),L=s("el-radio"),Q=s("el-radio-group"),X=s("el-dialog"),Y=ue("loading");return m(),v("div",me,[l(D,{class:"search-card",shadow:"never"},{default:a(()=>[l(S,{inline:!0,model:r,class:"search-form"},{default:a(()=>[l(d,{label:"产品分类"},{default:a(()=>[l(I,{modelValue:r.categoryId,"onUpdate:modelValue":e[0]||(e[0]=t=>r.categoryId=t),placeholder:"请选择分类",clearable:"",style:{width:"200px"}},{default:a(()=>[(m(!0),v($,null,j(V.value,t=>(m(),w(b,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"关键词"},{default:a(()=>[l(p,{modelValue:r.keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>r.keyword=t),placeholder:"请输入产品名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(d,{label:"状态"},{default:a(()=>[l(I,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=t=>r.status=t),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:a(()=>[l(b,{label:"上架",value:1}),l(b,{label:"下架",value:0})]),_:1},8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(g,{type:"primary",onClick:C},{default:a(()=>[...e[20]||(e[20]=[i("搜索",-1)])]),_:1}),l(g,{onClick:T},{default:a(()=>[...e[21]||(e[21]=[i("重置",-1)])]),_:1}),l(g,{type:"success",onClick:q},{default:a(()=>[...e[22]||(e[22]=[i("新增产品",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(D,{class:"table-card",shadow:"never"},{default:a(()=>[ie((m(),w(H,{data:h.value,border:"",style:{width:"100%"}},{default:a(()=>[l(u,{prop:"id",label:"ID",width:"80"}),l(u,{label:"产品图片",width:"100"},{default:a(({row:t})=>[t.image?(m(),w(A,{key:0,src:B(t.image),fit:"fill",style:{width:"60px",height:"60px","border-radius":"4px"},"preview-src-list":[B(t.image)]},null,8,["src","preview-src-list"])):(m(),v("span",ge,"-"))]),_:1}),l(u,{prop:"name",label:"产品名称","min-width":"200"}),l(u,{prop:"nameEn",label:"英文名称","min-width":"180"}),l(u,{label:"分类",width:"120"},{default:a(({row:t})=>[i(E(R(t.categoryId)),1)]),_:1}),l(u,{label:"价格",width:"100"},{default:a(({row:t})=>[i(" ¥"+E(t.price),1)]),_:1}),l(u,{prop:"stock",label:"库存",width:"80"}),l(u,{prop:"weight",label:"规格",width:"100"}),l(u,{prop:"viewCount",label:"浏览量",width:"100"}),l(u,{label:"状态",width:"80"},{default:a(({row:t})=>[l(G,{type:t.status===1?"success":"danger"},{default:a(()=>[i(E(t.status===1?"上架":"下架"),1)]),_:2},1032,["type"])]),_:1}),l(u,{label:"排序",width:"80",prop:"sortOrder"}),l(u,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[l(g,{type:"primary",size:"small",onClick:Z=>F(t)},{default:a(()=>[...e[23]||(e[23]=[i("编辑",-1)])]),_:1},8,["onClick"]),l(g,{type:"danger",size:"small",onClick:Z=>W(t)},{default:a(()=>[...e[24]||(e[24]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Y,k.value]]),pe("div",ce,[l(K,{"current-page":r.page,"onUpdate:currentPage":e[3]||(e[3]=t=>r.page=t),"page-size":r.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>r.pageSize=t),total:O.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:C,onCurrentChange:C},null,8,["current-page","page-size","total"])])]),_:1}),l(X,{modelValue:f.value,"onUpdate:modelValue":e[19]||(e[19]=t=>f.value=t),title:x.value,width:"800px","close-on-click-modal":!1},{footer:a(()=>[l(g,{onClick:e[18]||(e[18]=t=>f.value=!1)},{default:a(()=>[...e[27]||(e[27]=[i("取消",-1)])]),_:1}),l(g,{type:"primary",onClick:J},{default:a(()=>[...e[28]||(e[28]=[i("确定",-1)])]),_:1})]),default:a(()=>[l(S,{ref_key:"formRef",ref:U,model:o,rules:M,"label-width":"120px"},{default:a(()=>[l(d,{label:"产品分类",prop:"categoryId"},{default:a(()=>[l(I,{modelValue:o.categoryId,"onUpdate:modelValue":e[5]||(e[5]=t=>o.categoryId=t),placeholder:"请选择分类",style:{width:"100%"}},{default:a(()=>[(m(!0),v($,null,j(V.value,t=>(m(),w(b,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"产品名称",prop:"name"},{default:a(()=>[l(p,{modelValue:o.name,"onUpdate:modelValue":e[6]||(e[6]=t=>o.name=t),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"英文名称",prop:"nameEn"},{default:a(()=>[l(p,{modelValue:o.nameEn,"onUpdate:modelValue":e[7]||(e[7]=t=>o.nameEn=t),placeholder:"请输入英文名称"},null,8,["modelValue"])]),_:1}),l(d,{label:"副标题",prop:"subtitle"},{default:a(()=>[l(p,{modelValue:o.subtitle,"onUpdate:modelValue":e[8]||(e[8]=t=>o.subtitle=t),placeholder:"请输入副标题"},null,8,["modelValue"])]),_:1}),l(d,{label:"产品描述",prop:"description"},{default:a(()=>[l(p,{modelValue:o.description,"onUpdate:modelValue":e[9]||(e[9]=t=>o.description=t),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1}),l(d,{label:"主图片",prop:"image"},{default:a(()=>[l(ee,{modelValue:o.image,"onUpdate:modelValue":e[10]||(e[10]=t=>o.image=t),placeholder:"上传产品主图"},null,8,["modelValue"])]),_:1}),l(d,{label:"价格",prop:"price"},{default:a(()=>[l(z,{modelValue:o.price,"onUpdate:modelValue":e[11]||(e[11]=t=>o.price=t),min:0,precision:2,step:.1},null,8,["modelValue"])]),_:1}),l(d,{label:"库存",prop:"stock"},{default:a(()=>[l(z,{modelValue:o.stock,"onUpdate:modelValue":e[12]||(e[12]=t=>o.stock=t),min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"规格/重量",prop:"weight"},{default:a(()=>[l(p,{modelValue:o.weight,"onUpdate:modelValue":e[13]||(e[13]=t=>o.weight=t),placeholder:"例如：500g"},null,8,["modelValue"])]),_:1}),l(d,{label:"成分说明",prop:"ingredients"},{default:a(()=>[l(p,{modelValue:o.ingredients,"onUpdate:modelValue":e[14]||(e[14]=t=>o.ingredients=t),type:"textarea",rows:3,placeholder:"请输入成分说明"},null,8,["modelValue"])]),_:1}),l(d,{label:"使用方法",prop:"usage"},{default:a(()=>[l(p,{modelValue:o.usage,"onUpdate:modelValue":e[15]||(e[15]=t=>o.usage=t),type:"textarea",rows:3,placeholder:"请输入使用方法"},null,8,["modelValue"])]),_:1}),l(d,{label:"排序",prop:"sortOrder"},{default:a(()=>[l(z,{modelValue:o.sortOrder,"onUpdate:modelValue":e[16]||(e[16]=t=>o.sortOrder=t),min:0},null,8,["modelValue"])]),_:1}),l(d,{label:"状态",prop:"status"},{default:a(()=>[l(Q,{modelValue:o.status,"onUpdate:modelValue":e[17]||(e[17]=t=>o.status=t)},{default:a(()=>[l(L,{label:1},{default:a(()=>[...e[25]||(e[25]=[i("上架",-1)])]),_:1}),l(L,{label:0},{default:a(()=>[...e[26]||(e[26]=[i("下架",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},xe=re(fe,[["__scopeId","data-v-5d59e0cd"]]);export{xe as default};
