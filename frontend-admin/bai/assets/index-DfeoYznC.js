import{s as x}from"./index-D6S6O2v3.js";import{_ as ne}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{E as u,b as re}from"./element-plus-BcUKyH_i.js";import{r as v,l as O,c as se,j as ie,B as y,C as t,D as l,ak as r,aq as de,z as g,J as ue,M as i,y as pe,O as D,E as M,K as me}from"./vue-vendor-BRUv3CCy.js";function ce(f){return x({url:"/v1/banner/list",method:"get",params:f})}function fe(f){return x({url:"/v1/banner/create",method:"post",data:f})}function $(f){return x({url:"/v1/banner/update",method:"put",data:f})}function be(f){return x({url:"/v1/banner/delete",method:"delete",data:{bannerId:f}})}const ge={class:"banner-container"},_e={class:"card-header"},ve=["src"],ye=["src"],Ve={key:0,class:"preview-container"},Ue=["src"],ke=["src"],Te={__name:"index",setup(f){const C=v(!1),w=v([]),S=v(0),s=O({position:"",status:null,page:1,pageSize:10}),_=v(!1),h=v(""),z=v(null),n=O({bannerId:null,title:"",description:"",mediaType:1,mediaUrl:"",buttonText:"",buttonLink:"",position:"home",sortOrder:0,status:1}),q={title:[{required:!0,message:"请输入标题",trigger:"blur"}],mediaType:[{required:!0,message:"请选择媒体类型",trigger:"change"}],mediaUrl:[{required:!0,message:"请上传媒体文件",trigger:"change"}],position:[{required:!0,message:"请选择位置",trigger:"change"}]},B="http://localhost:8000",E={Authorization:"Bearer "+localStorage.getItem("token")},j=se(()=>n.mediaType===2?`${B}/api/v1/upload/video`:`${B}/api/v1/upload/image`),b=async()=>{C.value=!0;try{const o=await ce(s);w.value=o.data.list||[],S.value=o.data.total||0}catch{u.error("获取列表失败")}finally{C.value=!1}},N=()=>{s.page=1,b()},R=()=>{s.position="",s.status=null,s.page=1,b()},A=()=>{h.value="新增轮播图",_.value=!0},P=o=>{h.value="编辑轮播图",Object.assign(n,o),_.value=!0},W=async o=>{try{await re.confirm("确定要删除该轮播图吗？","提示",{type:"warning"}),await be(o.bannerId),u.success("删除成功"),b()}catch(e){e!=="cancel"&&u.error("删除失败")}},F=async o=>{try{await $({bannerId:o.bannerId,title:o.title,description:o.description,mediaType:o.mediaType,mediaUrl:o.mediaUrl,buttonText:o.buttonText,buttonLink:o.buttonLink,position:o.position,sortOrder:o.sortOrder,status:o.status}),u.success("状态更新成功")}catch{u.error("状态更新失败"),o.status=o.status===1?0:1}},H=o=>{o.code===0?(n.mediaUrl=o.data.url,u.success("上传成功")):u.error(o.message||"上传失败")},J=o=>{const e=o.type.startsWith("image/"),p=o.type.startsWith("video/");if(n.mediaType===1&&!e)return u.error("请上传图片文件"),!1;if(n.mediaType===2&&!p)return u.error("请上传视频文件"),!1;const m=n.mediaType===2?50:5;return o.size/1024/1024<m?!0:(u.error(`文件大小不能超过 ${m}MB`),!1)},K=async()=>{try{await z.value.validate(),n.bannerId?(await $(n),u.success("更新成功")):(await fe(n),u.success("创建成功")),_.value=!1,b()}catch(o){console.error(o)}},Q=()=>{var o;(o=z.value)==null||o.resetFields(),Object.assign(n,{bannerId:null,title:"",description:"",mediaType:1,mediaUrl:"",buttonText:"",buttonLink:"",position:"home",sortOrder:0,status:1})};return ie(()=>{b()}),(o,e)=>{const p=r("el-button"),m=r("el-option"),V=r("el-select"),d=r("el-form-item"),L=r("el-form"),c=r("el-table-column"),G=r("el-tag"),X=r("el-switch"),Y=r("el-table"),Z=r("el-pagination"),ee=r("el-card"),U=r("el-input"),k=r("el-radio"),I=r("el-radio-group"),te=r("el-upload"),le=r("el-input-number"),ae=r("el-dialog"),oe=de("loading");return g(),y("div",ge,[t(ee,null,{header:l(()=>[M("div",_e,[e[15]||(e[15]=M("span",null,"轮播图管理",-1)),t(p,{type:"primary",onClick:A},{default:l(()=>[...e[14]||(e[14]=[i("新增轮播图",-1)])]),_:1})])]),default:l(()=>[t(L,{inline:!0,model:s,class:"search-form"},{default:l(()=>[t(d,{label:"位置"},{default:l(()=>[t(V,{modelValue:s.position,"onUpdate:modelValue":e[0]||(e[0]=a=>s.position=a),placeholder:"请选择位置",clearable:""},{default:l(()=>[t(m,{label:"首页",value:"home"}),t(m,{label:"产品页",value:"product"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"状态"},{default:l(()=>[t(V,{modelValue:s.status,"onUpdate:modelValue":e[1]||(e[1]=a=>s.status=a),placeholder:"请选择状态",clearable:""},{default:l(()=>[t(m,{label:"启用",value:1}),t(m,{label:"停用",value:0})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:l(()=>[t(p,{type:"primary",onClick:N},{default:l(()=>[...e[16]||(e[16]=[i("查询",-1)])]),_:1}),t(p,{onClick:R},{default:l(()=>[...e[17]||(e[17]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),ue((g(),pe(Y,{data:w.value,border:""},{default:l(()=>[t(c,{label:"ID",prop:"bannerId",width:"80"}),t(c,{label:"预览",width:"150"},{default:l(({row:a})=>[a.mediaType===1?(g(),y("img",{key:0,src:a.mediaUrl,class:"preview-image"},null,8,ve)):(g(),y("video",{key:1,src:a.mediaUrl,class:"preview-image"},null,8,ye))]),_:1}),t(c,{label:"标题",prop:"title"}),t(c,{label:"描述",prop:"description","show-overflow-tooltip":""}),t(c,{label:"类型",width:"80"},{default:l(({row:a})=>[t(G,{type:a.mediaType===1?"success":"warning"},{default:l(()=>[i(D(a.mediaType===1?"图片":"视频"),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"位置",width:"100"},{default:l(({row:a})=>[i(D(a.position==="home"?"首页":"产品页"),1)]),_:1}),t(c,{label:"排序",prop:"sortOrder",width:"80"}),t(c,{label:"状态",width:"80"},{default:l(({row:a})=>[t(X,{modelValue:a.status,"onUpdate:modelValue":T=>a.status=T,"active-value":1,"inactive-value":0,onChange:T=>F(a)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(c,{label:"操作",width:"180",fixed:"right"},{default:l(({row:a})=>[t(p,{type:"primary",link:"",onClick:T=>P(a)},{default:l(()=>[...e[18]||(e[18]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(p,{type:"danger",link:"",onClick:T=>W(a)},{default:l(()=>[...e[19]||(e[19]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[oe,C.value]]),t(Z,{"current-page":s.page,"onUpdate:currentPage":e[2]||(e[2]=a=>s.page=a),"page-size":s.pageSize,"onUpdate:pageSize":e[3]||(e[3]=a=>s.pageSize=a),total:S.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:b,onCurrentChange:b},null,8,["current-page","page-size","total"])]),_:1}),t(ae,{modelValue:_.value,"onUpdate:modelValue":e[13]||(e[13]=a=>_.value=a),title:h.value,width:"600px",onClose:Q},{footer:l(()=>[t(p,{onClick:e[12]||(e[12]=a=>_.value=!1)},{default:l(()=>[...e[25]||(e[25]=[i("取消",-1)])]),_:1}),t(p,{type:"primary",onClick:K},{default:l(()=>[...e[26]||(e[26]=[i("确定",-1)])]),_:1})]),default:l(()=>[t(L,{ref_key:"formRef",ref:z,model:n,rules:q,"label-width":"100px"},{default:l(()=>[t(d,{label:"标题",prop:"title"},{default:l(()=>[t(U,{modelValue:n.title,"onUpdate:modelValue":e[4]||(e[4]=a=>n.title=a),placeholder:"请输入标题"},null,8,["modelValue"])]),_:1}),t(d,{label:"描述",prop:"description"},{default:l(()=>[t(U,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),t(d,{label:"媒体类型",prop:"mediaType"},{default:l(()=>[t(I,{modelValue:n.mediaType,"onUpdate:modelValue":e[6]||(e[6]=a=>n.mediaType=a)},{default:l(()=>[t(k,{label:1},{default:l(()=>[...e[20]||(e[20]=[i("图片",-1)])]),_:1}),t(k,{label:2},{default:l(()=>[...e[21]||(e[21]=[i("视频",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"媒体文件",prop:"mediaUrl"},{default:l(()=>[t(te,{class:"upload-demo",action:j.value,headers:E,"show-file-list":!1,"on-success":H,"before-upload":J},{default:l(()=>[t(p,{type:"primary"},{default:l(()=>[...e[22]||(e[22]=[i("点击上传",-1)])]),_:1})]),_:1},8,["action"]),n.mediaUrl?(g(),y("div",Ve,[n.mediaType===1?(g(),y("img",{key:0,src:n.mediaUrl,class:"preview"},null,8,Ue)):(g(),y("video",{key:1,src:n.mediaUrl,class:"preview",controls:""},null,8,ke))])):me("",!0)]),_:1}),t(d,{label:"按钮文字",prop:"buttonText"},{default:l(()=>[t(U,{modelValue:n.buttonText,"onUpdate:modelValue":e[7]||(e[7]=a=>n.buttonText=a),placeholder:"请输入按钮文字"},null,8,["modelValue"])]),_:1}),t(d,{label:"按钮链接",prop:"buttonLink"},{default:l(()=>[t(U,{modelValue:n.buttonLink,"onUpdate:modelValue":e[8]||(e[8]=a=>n.buttonLink=a),placeholder:"请输入按钮链接"},null,8,["modelValue"])]),_:1}),t(d,{label:"位置",prop:"position"},{default:l(()=>[t(V,{modelValue:n.position,"onUpdate:modelValue":e[9]||(e[9]=a=>n.position=a),placeholder:"请选择位置"},{default:l(()=>[t(m,{label:"首页",value:"home"}),t(m,{label:"产品页",value:"product"})]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"排序",prop:"sortOrder"},{default:l(()=>[t(le,{modelValue:n.sortOrder,"onUpdate:modelValue":e[10]||(e[10]=a=>n.sortOrder=a),min:0},null,8,["modelValue"])]),_:1}),t(d,{label:"状态",prop:"status"},{default:l(()=>[t(I,{modelValue:n.status,"onUpdate:modelValue":e[11]||(e[11]=a=>n.status=a)},{default:l(()=>[t(k,{label:1},{default:l(()=>[...e[23]||(e[23]=[i("启用",-1)])]),_:1}),t(k,{label:0},{default:l(()=>[...e[24]||(e[24]=[i("停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},we=ne(Te,[["__scopeId","data-v-85dca57c"]]);export{we as default};
