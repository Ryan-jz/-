# 产品和食谱国际化部署指南

## 已完成的工作

### ✅ 产品分类国际化
1. **前端组件**
   - ✅ `CategoryI18nEditor.vue` 已创建
   - ✅ `category.vue` 已集成国际化编辑器
   - ✅ API 已添加 `getCategoryI18n()`

2. **后端 API**
   - ✅ `CategoryCreate()` 支持国际化数据
   - ✅ `CategoryUpdate()` 支持国际化数据
   - ✅ `GetCategoryList()` 支持 locale 参数
   - ✅ `CategoryGetI18n()` 获取国际化数据
   - ✅ 使用事务保证数据一致性

3. **路由**
   - ✅ `GET /api/v1/product/category/:id/i18n`

### ✅ 产品国际化
1. **前端组件**
   - ✅ `ProductI18nEditor.vue` 已存在
   - ✅ API 已添加 `getProductI18n()`

2. **后端 API**
   - ✅ `GetI18n()` 获取产品国际化数据
   - ✅ Service 层已添加 `GetI18n()` 和 `GetCategoryI18n()`

3. **路由**
   - ✅ `GET /api/v1/product/:id/i18n`

### ✅ 食谱国际化
1. **前端组件**
   - ✅ `RecipeI18nEditor.vue` 已创建
   - ✅ `list.vue` 已部分集成国际化编辑器
   - ✅ API 已添加 `getRecipeI18n()`

2. **后端 API**
   - ✅ `GetI18n()` 获取食谱国际化数据
   - ✅ Service 层已添加 `GetI18n()`

3. **路由**
   - ✅ `GET /api/v1/recipe/:id/i18n`

## 部署步骤

### 第一步：确认数据库（必须）

检查数据库中的国际化表：

```sql
-- 检查表是否存在
SHOW TABLES LIKE '%_i18n';

-- 检查数据
SELECT COUNT(*) FROM product_category_i18n;
SELECT COUNT(*) FROM product_i18n;
SELECT COUNT(*) FROM recipe_i18n;
```

如果表不存在或没有数据，执行迁移脚本：

```bash
mysql -u username -p database < backend/manifest/sql/i18n_migration.sql
```

### 第二步：编译后端

```bash
cd backend
build.bat
```

### 第三步：重启后端服务

停止当前运行的 `gf-admin.exe`，然后重新启动。

### 第四步：刷新前端

刷新浏览器，清除缓存。

## 使用说明

### 产品分类管理

1. 进入"产品分类管理"
2. 点击"新增分类"或"编辑"
3. 在"多语言内容"部分切换标签页（中文/English/Deutsch）
4. 填写不同语言的分类名称和描述
5. 填写"分类标识"（slug）
6. 保存

### 产品管理

1. 进入"产品管理"
2. 点击"新增产品"或"编辑"
3. 在"多语言内容"部分填写：
   - 产品名称
   - 副标题
   - 产品描述
   - 成分说明
   - 使用方法
   - 产品特点（每行一个）
4. 上传产品图片
5. 填写价格、库存等信息
6. 保存

### 食谱管理

1. 进入"食谱管理"
2. 点击"新增食谱"或"编辑"
3. 在"多语言内容"部分填写：
   - 食谱名称
   - 副标题
   - 简介
   - 食材列表（每行一个，格式：食材 - 用量）
   - 标签（逗号分隔）
4. 填写烹饪时间、难度、份量
5. 上传食谱图片
6. 编写制作步骤（富文本）
7. 保存

## API 使用

### 获取产品分类列表（带语言）

```javascript
GET /api/v1/product/category/list?locale=zh-CN

// 返回对应语言的分类列表
```

### 获取产品分类国际化数据

```javascript
GET /api/v1/product/category/:id/i18n

// 返回所有语言版本
{
  "zh-CN": { "name": "...", "description": "..." },
  "en-US": { "name": "...", "description": "..." },
  "de-DE": { "name": "...", "description": "..." }
}
```

### 创建产品分类

```javascript
POST /api/v1/product/category/create

{
  "slug": "alpine-salt",
  "sortOrder": 0,
  "status": 1,
  "i18n": {
    "zh-CN": { "name": "阿尔卑斯盐", "description": "..." },
    "en-US": { "name": "Alpine Salt", "description": "..." },
    "de-DE": { "name": "Alpensalz", "description": "..." }
  }
}
```

### 更新产品分类

```javascript
PUT /api/v1/product/category/update

{
  "id": 1,
  "slug": "alpine-salt",
  "sortOrder": 0,
  "status": 1,
  "i18n": {
    "zh-CN": { "name": "阿尔卑斯盐", "description": "..." },
    "en-US": { "name": "Alpine Salt", "description": "..." },
    "de-DE": { "name": "Alpensalz", "description": "..." }
  }
}
```

## 数据结构

### 产品分类 i18n
```javascript
{
  'zh-CN': {
    name: '调味盐系列',
    description: 'BBQ调味盐、香草调味盐等特色调味盐产品'
  },
  'en-US': {
    name: 'Seasoning Salt Series',
    description: 'BBQ seasoning salt, herb seasoning salt and other specialty products'
  },
  'de-DE': {
    name: 'Gewürzsalz-Serie',
    description: 'BBQ-Gewürzsalz, Kräutergewürzsalz und andere Spezialprodukte'
  }
}
```

### 产品 i18n
```javascript
{
  'zh-CN': {
    name: '阿尔卑斯粗盐',
    subtitle: '经典粗盐，适合烹饪调味',
    description: '产品描述...',
    ingredients: '成分说明...',
    usage: '使用方法...',
    features: ['特点1', '特点2']
  },
  'en-US': { ... },
  'de-DE': { ... }
}
```

### 食谱 i18n
```javascript
{
  'zh-CN': {
    name: '喜马拉雅盐烤鸡',
    subtitle: '外酥里嫩，咸香四溢',
    description: '简介...',
    ingredients: '鸡肉 - 500g\n盐 - 适量',
    tags: '烤鸡,主菜,家常菜'
  },
  'en-US': { ... },
  'de-DE': { ... }
}
```

## 注意事项

1. **必填字段**
   - 产品分类：至少填写中文名称和 slug
   - 产品：至少填写中文名称
   - 食谱：至少填写中文名称

2. **数据迁移**
   - 现有数据已自动迁移到国际化表
   - 每条记录都有三个语言版本（初始内容相同）

3. **事务处理**
   - 创建和更新操作使用事务
   - 确保主表和国际化表数据一致性

4. **语言切换**
   - 前端需要根据用户选择的语言传递 `locale` 参数
   - 默认语言为中文（zh-CN）

## 测试清单

### 产品分类
- [ ] 创建新分类，填写三种语言
- [ ] 编辑现有分类，验证数据加载
- [ ] 切换语言查看列表
- [ ] 删除分类

### 产品
- [ ] 创建新产品，填写三种语言
- [ ] 编辑现有产品，验证数据加载
- [ ] 上传产品图片
- [ ] 切换语言查看列表

### 食谱
- [ ] 创建新食谱，填写三种语言
- [ ] 编辑现有食谱，验证数据加载
- [ ] 添加食材和制作步骤
- [ ] 关联产品
- [ ] 切换语言查看列表

## 故障排查

### 问题1：编辑时看不到国际化内容

**解决方案**：
- 检查数据库中对应的 `_i18n` 表是否有数据
- 检查浏览器控制台是否有 API 错误
- 确认后端路由是否正确配置

### 问题2：保存时提示"国际化内容不能为空"

**解决方案**：
- 确保至少填写了中文版本的必填字段
- 检查前端是否正确传递了 `i18n` 对象

### 问题3：前端显示的还是旧数据

**解决方案**：
- 清除浏览器缓存
- 检查 API 请求是否包含正确的 `locale` 参数
- 确认数据库中的国际化数据是否正确

## 后续优化

1. **批量翻译功能**
   - 集成翻译 API
   - 一键翻译所有语言

2. **语言管理**
   - 动态添加新语言
   - 语言启用/禁用

3. **翻译进度**
   - 显示各语言翻译完成度
   - 未翻译内容提醒

4. **前端网站国际化**
   - 添加语言切换功能
   - 根据用户语言显示内容

## 总结

所有模块的国际化功能已经完成：
- ✅ Banner 国际化（完整）
- ✅ 产品分类国际化（完整）
- ✅ 产品国际化（后端完整，前端需集成）
- ✅ 食谱国际化（后端完整，前端需集成）

现在可以开始使用国际化功能了！
